//
//  ArithmeticTests.swift
//  
//
//  Created by Dmitry Bespalov on 03.07.22.
//

import XCTest
@testable import BlockKit

class ArithmeticTests: XCTestCase {
    typealias Digit = UInt8

    // MARK: addition

    func test_addScalars() {
        // util_generateTable_addScalars()

        let table: [[Digit]] =
        [
        //  [a,    b,    c,  overflow]
            [0,    0,    0,    0,    ],
            [0,    1,    1,    0,    ],
            [0,    128,  128,  0,    ],
            [0,    254,  254,  0,    ],
            [0,    255,  255,  0,    ],
            [1,    0,    1,    0,    ],
            [1,    1,    2,    0,    ],
            [1,    128,  129,  0,    ],
            [1,    254,  255,  0,    ],
            [1,    255,  0,    1,    ],
            [128,  0,    128,  0,    ],
            [128,  1,    129,  0,    ],
            [128,  128,  0,    1,    ],
            [128,  254,  126,  1,    ],
            [128,  255,  127,  1,    ],
            [254,  0,    254,  0,    ],
            [254,  1,    255,  0,    ],
            [254,  128,  126,  1,    ],
            [254,  254,  252,  1,    ],
            [254,  255,  253,  1,    ],
            [255,  0,    255,  0,    ],
            [255,  1,    0,    1,    ],
            [255,  128,  127,  1,    ],
            [255,  254,  253,  1,    ],
            [255,  255,  254,  1,    ],
        ]

        for row in table {
            let sum = addScalars(row[0], row[1])
            XCTAssertEqual(sum.result, row[2], "\(row[0]) + \(row[1])")
            XCTAssertEqual(sum.overflow, row[3], "\(row[0]) + \(row[1])")
        }
    }

    func util_generateTable_addScalars() {
        let S: [UInt8] = [0, 1, 128, 254, 255]
        var table: [[Digit]] = []
        for a in S {
            for b in S {
                let result = a &+ b
                let overflow: Digit = result < a || result < b ? 1 : 0
                let row = [a, b, result, overflow]
                table.append(row)
            }
        }
        util_print_table(table)
    }

    func test_sum() {
        // util_generateTable_sum()

        let table: [[Digit]] =
        [
        //  [a0,  a1,   b0,   b1,   c0,   c1, overflow ]
            [0,    0,    0,    0,    0,    0,    0,    ],
            [0,    0,    0,    1,    0,    1,    0,    ],
            [0,    0,    0,    128,  0,    128,  0,    ],
            [0,    0,    0,    254,  0,    254,  0,    ],
            [0,    0,    0,    255,  0,    255,  0,    ],
            [0,    0,    1,    0,    1,    0,    0,    ],
            [0,    0,    1,    1,    1,    1,    0,    ],
            [0,    0,    1,    128,  1,    128,  0,    ],
            [0,    0,    1,    254,  1,    254,  0,    ],
            [0,    0,    1,    255,  1,    255,  0,    ],
            [0,    0,    128,  0,    128,  0,    0,    ],
            [0,    0,    128,  1,    128,  1,    0,    ],
            [0,    0,    128,  128,  128,  128,  0,    ],
            [0,    0,    128,  254,  128,  254,  0,    ],
            [0,    0,    128,  255,  128,  255,  0,    ],
            [0,    0,    254,  0,    254,  0,    0,    ],
            [0,    0,    254,  1,    254,  1,    0,    ],
            [0,    0,    254,  128,  254,  128,  0,    ],
            [0,    0,    254,  254,  254,  254,  0,    ],
            [0,    0,    254,  255,  254,  255,  0,    ],
            [0,    0,    255,  0,    255,  0,    0,    ],
            [0,    0,    255,  1,    255,  1,    0,    ],
            [0,    0,    255,  128,  255,  128,  0,    ],
            [0,    0,    255,  254,  255,  254,  0,    ],
            [0,    0,    255,  255,  255,  255,  0,    ],
            [0,    1,    0,    0,    0,    1,    0,    ],
            [0,    1,    0,    1,    0,    2,    0,    ],
            [0,    1,    0,    128,  0,    129,  0,    ],
            [0,    1,    0,    254,  0,    255,  0,    ],
            [0,    1,    0,    255,  0,    0,    1,    ],
            [0,    1,    1,    0,    1,    1,    0,    ],
            [0,    1,    1,    1,    1,    2,    0,    ],
            [0,    1,    1,    128,  1,    129,  0,    ],
            [0,    1,    1,    254,  1,    255,  0,    ],
            [0,    1,    1,    255,  1,    0,    1,    ],
            [0,    1,    128,  0,    128,  1,    0,    ],
            [0,    1,    128,  1,    128,  2,    0,    ],
            [0,    1,    128,  128,  128,  129,  0,    ],
            [0,    1,    128,  254,  128,  255,  0,    ],
            [0,    1,    128,  255,  128,  0,    1,    ],
            [0,    1,    254,  0,    254,  1,    0,    ],
            [0,    1,    254,  1,    254,  2,    0,    ],
            [0,    1,    254,  128,  254,  129,  0,    ],
            [0,    1,    254,  254,  254,  255,  0,    ],
            [0,    1,    254,  255,  254,  0,    1,    ],
            [0,    1,    255,  0,    255,  1,    0,    ],
            [0,    1,    255,  1,    255,  2,    0,    ],
            [0,    1,    255,  128,  255,  129,  0,    ],
            [0,    1,    255,  254,  255,  255,  0,    ],
            [0,    1,    255,  255,  255,  0,    1,    ],
            [0,    128,  0,    0,    0,    128,  0,    ],
            [0,    128,  0,    1,    0,    129,  0,    ],
            [0,    128,  0,    128,  0,    0,    1,    ],
            [0,    128,  0,    254,  0,    126,  1,    ],
            [0,    128,  0,    255,  0,    127,  1,    ],
            [0,    128,  1,    0,    1,    128,  0,    ],
            [0,    128,  1,    1,    1,    129,  0,    ],
            [0,    128,  1,    128,  1,    0,    1,    ],
            [0,    128,  1,    254,  1,    126,  1,    ],
            [0,    128,  1,    255,  1,    127,  1,    ],
            [0,    128,  128,  0,    128,  128,  0,    ],
            [0,    128,  128,  1,    128,  129,  0,    ],
            [0,    128,  128,  128,  128,  0,    1,    ],
            [0,    128,  128,  254,  128,  126,  1,    ],
            [0,    128,  128,  255,  128,  127,  1,    ],
            [0,    128,  254,  0,    254,  128,  0,    ],
            [0,    128,  254,  1,    254,  129,  0,    ],
            [0,    128,  254,  128,  254,  0,    1,    ],
            [0,    128,  254,  254,  254,  126,  1,    ],
            [0,    128,  254,  255,  254,  127,  1,    ],
            [0,    128,  255,  0,    255,  128,  0,    ],
            [0,    128,  255,  1,    255,  129,  0,    ],
            [0,    128,  255,  128,  255,  0,    1,    ],
            [0,    128,  255,  254,  255,  126,  1,    ],
            [0,    128,  255,  255,  255,  127,  1,    ],
            [0,    254,  0,    0,    0,    254,  0,    ],
            [0,    254,  0,    1,    0,    255,  0,    ],
            [0,    254,  0,    128,  0,    126,  1,    ],
            [0,    254,  0,    254,  0,    252,  1,    ],
            [0,    254,  0,    255,  0,    253,  1,    ],
            [0,    254,  1,    0,    1,    254,  0,    ],
            [0,    254,  1,    1,    1,    255,  0,    ],
            [0,    254,  1,    128,  1,    126,  1,    ],
            [0,    254,  1,    254,  1,    252,  1,    ],
            [0,    254,  1,    255,  1,    253,  1,    ],
            [0,    254,  128,  0,    128,  254,  0,    ],
            [0,    254,  128,  1,    128,  255,  0,    ],
            [0,    254,  128,  128,  128,  126,  1,    ],
            [0,    254,  128,  254,  128,  252,  1,    ],
            [0,    254,  128,  255,  128,  253,  1,    ],
            [0,    254,  254,  0,    254,  254,  0,    ],
            [0,    254,  254,  1,    254,  255,  0,    ],
            [0,    254,  254,  128,  254,  126,  1,    ],
            [0,    254,  254,  254,  254,  252,  1,    ],
            [0,    254,  254,  255,  254,  253,  1,    ],
            [0,    254,  255,  0,    255,  254,  0,    ],
            [0,    254,  255,  1,    255,  255,  0,    ],
            [0,    254,  255,  128,  255,  126,  1,    ],
            [0,    254,  255,  254,  255,  252,  1,    ],
            [0,    254,  255,  255,  255,  253,  1,    ],
            [0,    255,  0,    0,    0,    255,  0,    ],
            [0,    255,  0,    1,    0,    0,    1,    ],
            [0,    255,  0,    128,  0,    127,  1,    ],
            [0,    255,  0,    254,  0,    253,  1,    ],
            [0,    255,  0,    255,  0,    254,  1,    ],
            [0,    255,  1,    0,    1,    255,  0,    ],
            [0,    255,  1,    1,    1,    0,    1,    ],
            [0,    255,  1,    128,  1,    127,  1,    ],
            [0,    255,  1,    254,  1,    253,  1,    ],
            [0,    255,  1,    255,  1,    254,  1,    ],
            [0,    255,  128,  0,    128,  255,  0,    ],
            [0,    255,  128,  1,    128,  0,    1,    ],
            [0,    255,  128,  128,  128,  127,  1,    ],
            [0,    255,  128,  254,  128,  253,  1,    ],
            [0,    255,  128,  255,  128,  254,  1,    ],
            [0,    255,  254,  0,    254,  255,  0,    ],
            [0,    255,  254,  1,    254,  0,    1,    ],
            [0,    255,  254,  128,  254,  127,  1,    ],
            [0,    255,  254,  254,  254,  253,  1,    ],
            [0,    255,  254,  255,  254,  254,  1,    ],
            [0,    255,  255,  0,    255,  255,  0,    ],
            [0,    255,  255,  1,    255,  0,    1,    ],
            [0,    255,  255,  128,  255,  127,  1,    ],
            [0,    255,  255,  254,  255,  253,  1,    ],
            [0,    255,  255,  255,  255,  254,  1,    ],
            [1,    0,    0,    0,    1,    0,    0,    ],
            [1,    0,    0,    1,    1,    1,    0,    ],
            [1,    0,    0,    128,  1,    128,  0,    ],
            [1,    0,    0,    254,  1,    254,  0,    ],
            [1,    0,    0,    255,  1,    255,  0,    ],
            [1,    0,    1,    0,    2,    0,    0,    ],
            [1,    0,    1,    1,    2,    1,    0,    ],
            [1,    0,    1,    128,  2,    128,  0,    ],
            [1,    0,    1,    254,  2,    254,  0,    ],
            [1,    0,    1,    255,  2,    255,  0,    ],
            [1,    0,    128,  0,    129,  0,    0,    ],
            [1,    0,    128,  1,    129,  1,    0,    ],
            [1,    0,    128,  128,  129,  128,  0,    ],
            [1,    0,    128,  254,  129,  254,  0,    ],
            [1,    0,    128,  255,  129,  255,  0,    ],
            [1,    0,    254,  0,    255,  0,    0,    ],
            [1,    0,    254,  1,    255,  1,    0,    ],
            [1,    0,    254,  128,  255,  128,  0,    ],
            [1,    0,    254,  254,  255,  254,  0,    ],
            [1,    0,    254,  255,  255,  255,  0,    ],
            [1,    0,    255,  0,    0,    1,    0,    ],
            [1,    0,    255,  1,    0,    2,    0,    ],
            [1,    0,    255,  128,  0,    129,  0,    ],
            [1,    0,    255,  254,  0,    255,  0,    ],
            [1,    0,    255,  255,  0,    0,    1,    ],
            [1,    1,    0,    0,    1,    1,    0,    ],
            [1,    1,    0,    1,    1,    2,    0,    ],
            [1,    1,    0,    128,  1,    129,  0,    ],
            [1,    1,    0,    254,  1,    255,  0,    ],
            [1,    1,    0,    255,  1,    0,    1,    ],
            [1,    1,    1,    0,    2,    1,    0,    ],
            [1,    1,    1,    1,    2,    2,    0,    ],
            [1,    1,    1,    128,  2,    129,  0,    ],
            [1,    1,    1,    254,  2,    255,  0,    ],
            [1,    1,    1,    255,  2,    0,    1,    ],
            [1,    1,    128,  0,    129,  1,    0,    ],
            [1,    1,    128,  1,    129,  2,    0,    ],
            [1,    1,    128,  128,  129,  129,  0,    ],
            [1,    1,    128,  254,  129,  255,  0,    ],
            [1,    1,    128,  255,  129,  0,    1,    ],
            [1,    1,    254,  0,    255,  1,    0,    ],
            [1,    1,    254,  1,    255,  2,    0,    ],
            [1,    1,    254,  128,  255,  129,  0,    ],
            [1,    1,    254,  254,  255,  255,  0,    ],
            [1,    1,    254,  255,  255,  0,    1,    ],
            [1,    1,    255,  0,    0,    2,    0,    ],
            [1,    1,    255,  1,    0,    3,    0,    ],
            [1,    1,    255,  128,  0,    130,  0,    ],
            [1,    1,    255,  254,  0,    0,    1,    ],
            [1,    1,    255,  255,  0,    1,    1,    ],
            [1,    128,  0,    0,    1,    128,  0,    ],
            [1,    128,  0,    1,    1,    129,  0,    ],
            [1,    128,  0,    128,  1,    0,    1,    ],
            [1,    128,  0,    254,  1,    126,  1,    ],
            [1,    128,  0,    255,  1,    127,  1,    ],
            [1,    128,  1,    0,    2,    128,  0,    ],
            [1,    128,  1,    1,    2,    129,  0,    ],
            [1,    128,  1,    128,  2,    0,    1,    ],
            [1,    128,  1,    254,  2,    126,  1,    ],
            [1,    128,  1,    255,  2,    127,  1,    ],
            [1,    128,  128,  0,    129,  128,  0,    ],
            [1,    128,  128,  1,    129,  129,  0,    ],
            [1,    128,  128,  128,  129,  0,    1,    ],
            [1,    128,  128,  254,  129,  126,  1,    ],
            [1,    128,  128,  255,  129,  127,  1,    ],
            [1,    128,  254,  0,    255,  128,  0,    ],
            [1,    128,  254,  1,    255,  129,  0,    ],
            [1,    128,  254,  128,  255,  0,    1,    ],
            [1,    128,  254,  254,  255,  126,  1,    ],
            [1,    128,  254,  255,  255,  127,  1,    ],
            [1,    128,  255,  0,    0,    129,  0,    ],
            [1,    128,  255,  1,    0,    130,  0,    ],
            [1,    128,  255,  128,  0,    1,    1,    ],
            [1,    128,  255,  254,  0,    127,  1,    ],
            [1,    128,  255,  255,  0,    128,  1,    ],
            [1,    254,  0,    0,    1,    254,  0,    ],
            [1,    254,  0,    1,    1,    255,  0,    ],
            [1,    254,  0,    128,  1,    126,  1,    ],
            [1,    254,  0,    254,  1,    252,  1,    ],
            [1,    254,  0,    255,  1,    253,  1,    ],
            [1,    254,  1,    0,    2,    254,  0,    ],
            [1,    254,  1,    1,    2,    255,  0,    ],
            [1,    254,  1,    128,  2,    126,  1,    ],
            [1,    254,  1,    254,  2,    252,  1,    ],
            [1,    254,  1,    255,  2,    253,  1,    ],
            [1,    254,  128,  0,    129,  254,  0,    ],
            [1,    254,  128,  1,    129,  255,  0,    ],
            [1,    254,  128,  128,  129,  126,  1,    ],
            [1,    254,  128,  254,  129,  252,  1,    ],
            [1,    254,  128,  255,  129,  253,  1,    ],
            [1,    254,  254,  0,    255,  254,  0,    ],
            [1,    254,  254,  1,    255,  255,  0,    ],
            [1,    254,  254,  128,  255,  126,  1,    ],
            [1,    254,  254,  254,  255,  252,  1,    ],
            [1,    254,  254,  255,  255,  253,  1,    ],
            [1,    254,  255,  0,    0,    255,  0,    ],
            [1,    254,  255,  1,    0,    0,    1,    ],
            [1,    254,  255,  128,  0,    127,  1,    ],
            [1,    254,  255,  254,  0,    253,  1,    ],
            [1,    254,  255,  255,  0,    254,  1,    ],
            [1,    255,  0,    0,    1,    255,  0,    ],
            [1,    255,  0,    1,    1,    0,    1,    ],
            [1,    255,  0,    128,  1,    127,  1,    ],
            [1,    255,  0,    254,  1,    253,  1,    ],
            [1,    255,  0,    255,  1,    254,  1,    ],
            [1,    255,  1,    0,    2,    255,  0,    ],
            [1,    255,  1,    1,    2,    0,    1,    ],
            [1,    255,  1,    128,  2,    127,  1,    ],
            [1,    255,  1,    254,  2,    253,  1,    ],
            [1,    255,  1,    255,  2,    254,  1,    ],
            [1,    255,  128,  0,    129,  255,  0,    ],
            [1,    255,  128,  1,    129,  0,    1,    ],
            [1,    255,  128,  128,  129,  127,  1,    ],
            [1,    255,  128,  254,  129,  253,  1,    ],
            [1,    255,  128,  255,  129,  254,  1,    ],
            [1,    255,  254,  0,    255,  255,  0,    ],
            [1,    255,  254,  1,    255,  0,    1,    ],
            [1,    255,  254,  128,  255,  127,  1,    ],
            [1,    255,  254,  254,  255,  253,  1,    ],
            [1,    255,  254,  255,  255,  254,  1,    ],
            [1,    255,  255,  0,    0,    0,    1,    ],
            [1,    255,  255,  1,    0,    1,    1,    ],
            [1,    255,  255,  128,  0,    128,  1,    ],
            [1,    255,  255,  254,  0,    254,  1,    ],
            [1,    255,  255,  255,  0,    255,  1,    ],
            [128,  0,    0,    0,    128,  0,    0,    ],
            [128,  0,    0,    1,    128,  1,    0,    ],
            [128,  0,    0,    128,  128,  128,  0,    ],
            [128,  0,    0,    254,  128,  254,  0,    ],
            [128,  0,    0,    255,  128,  255,  0,    ],
            [128,  0,    1,    0,    129,  0,    0,    ],
            [128,  0,    1,    1,    129,  1,    0,    ],
            [128,  0,    1,    128,  129,  128,  0,    ],
            [128,  0,    1,    254,  129,  254,  0,    ],
            [128,  0,    1,    255,  129,  255,  0,    ],
            [128,  0,    128,  0,    0,    1,    0,    ],
            [128,  0,    128,  1,    0,    2,    0,    ],
            [128,  0,    128,  128,  0,    129,  0,    ],
            [128,  0,    128,  254,  0,    255,  0,    ],
            [128,  0,    128,  255,  0,    0,    1,    ],
            [128,  0,    254,  0,    126,  1,    0,    ],
            [128,  0,    254,  1,    126,  2,    0,    ],
            [128,  0,    254,  128,  126,  129,  0,    ],
            [128,  0,    254,  254,  126,  255,  0,    ],
            [128,  0,    254,  255,  126,  0,    1,    ],
            [128,  0,    255,  0,    127,  1,    0,    ],
            [128,  0,    255,  1,    127,  2,    0,    ],
            [128,  0,    255,  128,  127,  129,  0,    ],
            [128,  0,    255,  254,  127,  255,  0,    ],
            [128,  0,    255,  255,  127,  0,    1,    ],
            [128,  1,    0,    0,    128,  1,    0,    ],
            [128,  1,    0,    1,    128,  2,    0,    ],
            [128,  1,    0,    128,  128,  129,  0,    ],
            [128,  1,    0,    254,  128,  255,  0,    ],
            [128,  1,    0,    255,  128,  0,    1,    ],
            [128,  1,    1,    0,    129,  1,    0,    ],
            [128,  1,    1,    1,    129,  2,    0,    ],
            [128,  1,    1,    128,  129,  129,  0,    ],
            [128,  1,    1,    254,  129,  255,  0,    ],
            [128,  1,    1,    255,  129,  0,    1,    ],
            [128,  1,    128,  0,    0,    2,    0,    ],
            [128,  1,    128,  1,    0,    3,    0,    ],
            [128,  1,    128,  128,  0,    130,  0,    ],
            [128,  1,    128,  254,  0,    0,    1,    ],
            [128,  1,    128,  255,  0,    1,    1,    ],
            [128,  1,    254,  0,    126,  2,    0,    ],
            [128,  1,    254,  1,    126,  3,    0,    ],
            [128,  1,    254,  128,  126,  130,  0,    ],
            [128,  1,    254,  254,  126,  0,    1,    ],
            [128,  1,    254,  255,  126,  1,    1,    ],
            [128,  1,    255,  0,    127,  2,    0,    ],
            [128,  1,    255,  1,    127,  3,    0,    ],
            [128,  1,    255,  128,  127,  130,  0,    ],
            [128,  1,    255,  254,  127,  0,    1,    ],
            [128,  1,    255,  255,  127,  1,    1,    ],
            [128,  128,  0,    0,    128,  128,  0,    ],
            [128,  128,  0,    1,    128,  129,  0,    ],
            [128,  128,  0,    128,  128,  0,    1,    ],
            [128,  128,  0,    254,  128,  126,  1,    ],
            [128,  128,  0,    255,  128,  127,  1,    ],
            [128,  128,  1,    0,    129,  128,  0,    ],
            [128,  128,  1,    1,    129,  129,  0,    ],
            [128,  128,  1,    128,  129,  0,    1,    ],
            [128,  128,  1,    254,  129,  126,  1,    ],
            [128,  128,  1,    255,  129,  127,  1,    ],
            [128,  128,  128,  0,    0,    129,  0,    ],
            [128,  128,  128,  1,    0,    130,  0,    ],
            [128,  128,  128,  128,  0,    1,    1,    ],
            [128,  128,  128,  254,  0,    127,  1,    ],
            [128,  128,  128,  255,  0,    128,  1,    ],
            [128,  128,  254,  0,    126,  129,  0,    ],
            [128,  128,  254,  1,    126,  130,  0,    ],
            [128,  128,  254,  128,  126,  1,    1,    ],
            [128,  128,  254,  254,  126,  127,  1,    ],
            [128,  128,  254,  255,  126,  128,  1,    ],
            [128,  128,  255,  0,    127,  129,  0,    ],
            [128,  128,  255,  1,    127,  130,  0,    ],
            [128,  128,  255,  128,  127,  1,    1,    ],
            [128,  128,  255,  254,  127,  127,  1,    ],
            [128,  128,  255,  255,  127,  128,  1,    ],
            [128,  254,  0,    0,    128,  254,  0,    ],
            [128,  254,  0,    1,    128,  255,  0,    ],
            [128,  254,  0,    128,  128,  126,  1,    ],
            [128,  254,  0,    254,  128,  252,  1,    ],
            [128,  254,  0,    255,  128,  253,  1,    ],
            [128,  254,  1,    0,    129,  254,  0,    ],
            [128,  254,  1,    1,    129,  255,  0,    ],
            [128,  254,  1,    128,  129,  126,  1,    ],
            [128,  254,  1,    254,  129,  252,  1,    ],
            [128,  254,  1,    255,  129,  253,  1,    ],
            [128,  254,  128,  0,    0,    255,  0,    ],
            [128,  254,  128,  1,    0,    0,    1,    ],
            [128,  254,  128,  128,  0,    127,  1,    ],
            [128,  254,  128,  254,  0,    253,  1,    ],
            [128,  254,  128,  255,  0,    254,  1,    ],
            [128,  254,  254,  0,    126,  255,  0,    ],
            [128,  254,  254,  1,    126,  0,    1,    ],
            [128,  254,  254,  128,  126,  127,  1,    ],
            [128,  254,  254,  254,  126,  253,  1,    ],
            [128,  254,  254,  255,  126,  254,  1,    ],
            [128,  254,  255,  0,    127,  255,  0,    ],
            [128,  254,  255,  1,    127,  0,    1,    ],
            [128,  254,  255,  128,  127,  127,  1,    ],
            [128,  254,  255,  254,  127,  253,  1,    ],
            [128,  254,  255,  255,  127,  254,  1,    ],
            [128,  255,  0,    0,    128,  255,  0,    ],
            [128,  255,  0,    1,    128,  0,    1,    ],
            [128,  255,  0,    128,  128,  127,  1,    ],
            [128,  255,  0,    254,  128,  253,  1,    ],
            [128,  255,  0,    255,  128,  254,  1,    ],
            [128,  255,  1,    0,    129,  255,  0,    ],
            [128,  255,  1,    1,    129,  0,    1,    ],
            [128,  255,  1,    128,  129,  127,  1,    ],
            [128,  255,  1,    254,  129,  253,  1,    ],
            [128,  255,  1,    255,  129,  254,  1,    ],
            [128,  255,  128,  0,    0,    0,    1,    ],
            [128,  255,  128,  1,    0,    1,    1,    ],
            [128,  255,  128,  128,  0,    128,  1,    ],
            [128,  255,  128,  254,  0,    254,  1,    ],
            [128,  255,  128,  255,  0,    255,  1,    ],
            [128,  255,  254,  0,    126,  0,    1,    ],
            [128,  255,  254,  1,    126,  1,    1,    ],
            [128,  255,  254,  128,  126,  128,  1,    ],
            [128,  255,  254,  254,  126,  254,  1,    ],
            [128,  255,  254,  255,  126,  255,  1,    ],
            [128,  255,  255,  0,    127,  0,    1,    ],
            [128,  255,  255,  1,    127,  1,    1,    ],
            [128,  255,  255,  128,  127,  128,  1,    ],
            [128,  255,  255,  254,  127,  254,  1,    ],
            [128,  255,  255,  255,  127,  255,  1,    ],
            [254,  0,    0,    0,    254,  0,    0,    ],
            [254,  0,    0,    1,    254,  1,    0,    ],
            [254,  0,    0,    128,  254,  128,  0,    ],
            [254,  0,    0,    254,  254,  254,  0,    ],
            [254,  0,    0,    255,  254,  255,  0,    ],
            [254,  0,    1,    0,    255,  0,    0,    ],
            [254,  0,    1,    1,    255,  1,    0,    ],
            [254,  0,    1,    128,  255,  128,  0,    ],
            [254,  0,    1,    254,  255,  254,  0,    ],
            [254,  0,    1,    255,  255,  255,  0,    ],
            [254,  0,    128,  0,    126,  1,    0,    ],
            [254,  0,    128,  1,    126,  2,    0,    ],
            [254,  0,    128,  128,  126,  129,  0,    ],
            [254,  0,    128,  254,  126,  255,  0,    ],
            [254,  0,    128,  255,  126,  0,    1,    ],
            [254,  0,    254,  0,    252,  1,    0,    ],
            [254,  0,    254,  1,    252,  2,    0,    ],
            [254,  0,    254,  128,  252,  129,  0,    ],
            [254,  0,    254,  254,  252,  255,  0,    ],
            [254,  0,    254,  255,  252,  0,    1,    ],
            [254,  0,    255,  0,    253,  1,    0,    ],
            [254,  0,    255,  1,    253,  2,    0,    ],
            [254,  0,    255,  128,  253,  129,  0,    ],
            [254,  0,    255,  254,  253,  255,  0,    ],
            [254,  0,    255,  255,  253,  0,    1,    ],
            [254,  1,    0,    0,    254,  1,    0,    ],
            [254,  1,    0,    1,    254,  2,    0,    ],
            [254,  1,    0,    128,  254,  129,  0,    ],
            [254,  1,    0,    254,  254,  255,  0,    ],
            [254,  1,    0,    255,  254,  0,    1,    ],
            [254,  1,    1,    0,    255,  1,    0,    ],
            [254,  1,    1,    1,    255,  2,    0,    ],
            [254,  1,    1,    128,  255,  129,  0,    ],
            [254,  1,    1,    254,  255,  255,  0,    ],
            [254,  1,    1,    255,  255,  0,    1,    ],
            [254,  1,    128,  0,    126,  2,    0,    ],
            [254,  1,    128,  1,    126,  3,    0,    ],
            [254,  1,    128,  128,  126,  130,  0,    ],
            [254,  1,    128,  254,  126,  0,    1,    ],
            [254,  1,    128,  255,  126,  1,    1,    ],
            [254,  1,    254,  0,    252,  2,    0,    ],
            [254,  1,    254,  1,    252,  3,    0,    ],
            [254,  1,    254,  128,  252,  130,  0,    ],
            [254,  1,    254,  254,  252,  0,    1,    ],
            [254,  1,    254,  255,  252,  1,    1,    ],
            [254,  1,    255,  0,    253,  2,    0,    ],
            [254,  1,    255,  1,    253,  3,    0,    ],
            [254,  1,    255,  128,  253,  130,  0,    ],
            [254,  1,    255,  254,  253,  0,    1,    ],
            [254,  1,    255,  255,  253,  1,    1,    ],
            [254,  128,  0,    0,    254,  128,  0,    ],
            [254,  128,  0,    1,    254,  129,  0,    ],
            [254,  128,  0,    128,  254,  0,    1,    ],
            [254,  128,  0,    254,  254,  126,  1,    ],
            [254,  128,  0,    255,  254,  127,  1,    ],
            [254,  128,  1,    0,    255,  128,  0,    ],
            [254,  128,  1,    1,    255,  129,  0,    ],
            [254,  128,  1,    128,  255,  0,    1,    ],
            [254,  128,  1,    254,  255,  126,  1,    ],
            [254,  128,  1,    255,  255,  127,  1,    ],
            [254,  128,  128,  0,    126,  129,  0,    ],
            [254,  128,  128,  1,    126,  130,  0,    ],
            [254,  128,  128,  128,  126,  1,    1,    ],
            [254,  128,  128,  254,  126,  127,  1,    ],
            [254,  128,  128,  255,  126,  128,  1,    ],
            [254,  128,  254,  0,    252,  129,  0,    ],
            [254,  128,  254,  1,    252,  130,  0,    ],
            [254,  128,  254,  128,  252,  1,    1,    ],
            [254,  128,  254,  254,  252,  127,  1,    ],
            [254,  128,  254,  255,  252,  128,  1,    ],
            [254,  128,  255,  0,    253,  129,  0,    ],
            [254,  128,  255,  1,    253,  130,  0,    ],
            [254,  128,  255,  128,  253,  1,    1,    ],
            [254,  128,  255,  254,  253,  127,  1,    ],
            [254,  128,  255,  255,  253,  128,  1,    ],
            [254,  254,  0,    0,    254,  254,  0,    ],
            [254,  254,  0,    1,    254,  255,  0,    ],
            [254,  254,  0,    128,  254,  126,  1,    ],
            [254,  254,  0,    254,  254,  252,  1,    ],
            [254,  254,  0,    255,  254,  253,  1,    ],
            [254,  254,  1,    0,    255,  254,  0,    ],
            [254,  254,  1,    1,    255,  255,  0,    ],
            [254,  254,  1,    128,  255,  126,  1,    ],
            [254,  254,  1,    254,  255,  252,  1,    ],
            [254,  254,  1,    255,  255,  253,  1,    ],
            [254,  254,  128,  0,    126,  255,  0,    ],
            [254,  254,  128,  1,    126,  0,    1,    ],
            [254,  254,  128,  128,  126,  127,  1,    ],
            [254,  254,  128,  254,  126,  253,  1,    ],
            [254,  254,  128,  255,  126,  254,  1,    ],
            [254,  254,  254,  0,    252,  255,  0,    ],
            [254,  254,  254,  1,    252,  0,    1,    ],
            [254,  254,  254,  128,  252,  127,  1,    ],
            [254,  254,  254,  254,  252,  253,  1,    ],
            [254,  254,  254,  255,  252,  254,  1,    ],
            [254,  254,  255,  0,    253,  255,  0,    ],
            [254,  254,  255,  1,    253,  0,    1,    ],
            [254,  254,  255,  128,  253,  127,  1,    ],
            [254,  254,  255,  254,  253,  253,  1,    ],
            [254,  254,  255,  255,  253,  254,  1,    ],
            [254,  255,  0,    0,    254,  255,  0,    ],
            [254,  255,  0,    1,    254,  0,    1,    ],
            [254,  255,  0,    128,  254,  127,  1,    ],
            [254,  255,  0,    254,  254,  253,  1,    ],
            [254,  255,  0,    255,  254,  254,  1,    ],
            [254,  255,  1,    0,    255,  255,  0,    ],
            [254,  255,  1,    1,    255,  0,    1,    ],
            [254,  255,  1,    128,  255,  127,  1,    ],
            [254,  255,  1,    254,  255,  253,  1,    ],
            [254,  255,  1,    255,  255,  254,  1,    ],
            [254,  255,  128,  0,    126,  0,    1,    ],
            [254,  255,  128,  1,    126,  1,    1,    ],
            [254,  255,  128,  128,  126,  128,  1,    ],
            [254,  255,  128,  254,  126,  254,  1,    ],
            [254,  255,  128,  255,  126,  255,  1,    ],
            [254,  255,  254,  0,    252,  0,    1,    ],
            [254,  255,  254,  1,    252,  1,    1,    ],
            [254,  255,  254,  128,  252,  128,  1,    ],
            [254,  255,  254,  254,  252,  254,  1,    ],
            [254,  255,  254,  255,  252,  255,  1,    ],
            [254,  255,  255,  0,    253,  0,    1,    ],
            [254,  255,  255,  1,    253,  1,    1,    ],
            [254,  255,  255,  128,  253,  128,  1,    ],
            [254,  255,  255,  254,  253,  254,  1,    ],
            [254,  255,  255,  255,  253,  255,  1,    ],
            [255,  0,    0,    0,    255,  0,    0,    ],
            [255,  0,    0,    1,    255,  1,    0,    ],
            [255,  0,    0,    128,  255,  128,  0,    ],
            [255,  0,    0,    254,  255,  254,  0,    ],
            [255,  0,    0,    255,  255,  255,  0,    ],
            [255,  0,    1,    0,    0,    1,    0,    ],
            [255,  0,    1,    1,    0,    2,    0,    ],
            [255,  0,    1,    128,  0,    129,  0,    ],
            [255,  0,    1,    254,  0,    255,  0,    ],
            [255,  0,    1,    255,  0,    0,    1,    ],
            [255,  0,    128,  0,    127,  1,    0,    ],
            [255,  0,    128,  1,    127,  2,    0,    ],
            [255,  0,    128,  128,  127,  129,  0,    ],
            [255,  0,    128,  254,  127,  255,  0,    ],
            [255,  0,    128,  255,  127,  0,    1,    ],
            [255,  0,    254,  0,    253,  1,    0,    ],
            [255,  0,    254,  1,    253,  2,    0,    ],
            [255,  0,    254,  128,  253,  129,  0,    ],
            [255,  0,    254,  254,  253,  255,  0,    ],
            [255,  0,    254,  255,  253,  0,    1,    ],
            [255,  0,    255,  0,    254,  1,    0,    ],
            [255,  0,    255,  1,    254,  2,    0,    ],
            [255,  0,    255,  128,  254,  129,  0,    ],
            [255,  0,    255,  254,  254,  255,  0,    ],
            [255,  0,    255,  255,  254,  0,    1,    ],
            [255,  1,    0,    0,    255,  1,    0,    ],
            [255,  1,    0,    1,    255,  2,    0,    ],
            [255,  1,    0,    128,  255,  129,  0,    ],
            [255,  1,    0,    254,  255,  255,  0,    ],
            [255,  1,    0,    255,  255,  0,    1,    ],
            [255,  1,    1,    0,    0,    2,    0,    ],
            [255,  1,    1,    1,    0,    3,    0,    ],
            [255,  1,    1,    128,  0,    130,  0,    ],
            [255,  1,    1,    254,  0,    0,    1,    ],
            [255,  1,    1,    255,  0,    1,    1,    ],
            [255,  1,    128,  0,    127,  2,    0,    ],
            [255,  1,    128,  1,    127,  3,    0,    ],
            [255,  1,    128,  128,  127,  130,  0,    ],
            [255,  1,    128,  254,  127,  0,    1,    ],
            [255,  1,    128,  255,  127,  1,    1,    ],
            [255,  1,    254,  0,    253,  2,    0,    ],
            [255,  1,    254,  1,    253,  3,    0,    ],
            [255,  1,    254,  128,  253,  130,  0,    ],
            [255,  1,    254,  254,  253,  0,    1,    ],
            [255,  1,    254,  255,  253,  1,    1,    ],
            [255,  1,    255,  0,    254,  2,    0,    ],
            [255,  1,    255,  1,    254,  3,    0,    ],
            [255,  1,    255,  128,  254,  130,  0,    ],
            [255,  1,    255,  254,  254,  0,    1,    ],
            [255,  1,    255,  255,  254,  1,    1,    ],
            [255,  128,  0,    0,    255,  128,  0,    ],
            [255,  128,  0,    1,    255,  129,  0,    ],
            [255,  128,  0,    128,  255,  0,    1,    ],
            [255,  128,  0,    254,  255,  126,  1,    ],
            [255,  128,  0,    255,  255,  127,  1,    ],
            [255,  128,  1,    0,    0,    129,  0,    ],
            [255,  128,  1,    1,    0,    130,  0,    ],
            [255,  128,  1,    128,  0,    1,    1,    ],
            [255,  128,  1,    254,  0,    127,  1,    ],
            [255,  128,  1,    255,  0,    128,  1,    ],
            [255,  128,  128,  0,    127,  129,  0,    ],
            [255,  128,  128,  1,    127,  130,  0,    ],
            [255,  128,  128,  128,  127,  1,    1,    ],
            [255,  128,  128,  254,  127,  127,  1,    ],
            [255,  128,  128,  255,  127,  128,  1,    ],
            [255,  128,  254,  0,    253,  129,  0,    ],
            [255,  128,  254,  1,    253,  130,  0,    ],
            [255,  128,  254,  128,  253,  1,    1,    ],
            [255,  128,  254,  254,  253,  127,  1,    ],
            [255,  128,  254,  255,  253,  128,  1,    ],
            [255,  128,  255,  0,    254,  129,  0,    ],
            [255,  128,  255,  1,    254,  130,  0,    ],
            [255,  128,  255,  128,  254,  1,    1,    ],
            [255,  128,  255,  254,  254,  127,  1,    ],
            [255,  128,  255,  255,  254,  128,  1,    ],
            [255,  254,  0,    0,    255,  254,  0,    ],
            [255,  254,  0,    1,    255,  255,  0,    ],
            [255,  254,  0,    128,  255,  126,  1,    ],
            [255,  254,  0,    254,  255,  252,  1,    ],
            [255,  254,  0,    255,  255,  253,  1,    ],
            [255,  254,  1,    0,    0,    255,  0,    ],
            [255,  254,  1,    1,    0,    0,    1,    ],
            [255,  254,  1,    128,  0,    127,  1,    ],
            [255,  254,  1,    254,  0,    253,  1,    ],
            [255,  254,  1,    255,  0,    254,  1,    ],
            [255,  254,  128,  0,    127,  255,  0,    ],
            [255,  254,  128,  1,    127,  0,    1,    ],
            [255,  254,  128,  128,  127,  127,  1,    ],
            [255,  254,  128,  254,  127,  253,  1,    ],
            [255,  254,  128,  255,  127,  254,  1,    ],
            [255,  254,  254,  0,    253,  255,  0,    ],
            [255,  254,  254,  1,    253,  0,    1,    ],
            [255,  254,  254,  128,  253,  127,  1,    ],
            [255,  254,  254,  254,  253,  253,  1,    ],
            [255,  254,  254,  255,  253,  254,  1,    ],
            [255,  254,  255,  0,    254,  255,  0,    ],
            [255,  254,  255,  1,    254,  0,    1,    ],
            [255,  254,  255,  128,  254,  127,  1,    ],
            [255,  254,  255,  254,  254,  253,  1,    ],
            [255,  254,  255,  255,  254,  254,  1,    ],
            [255,  255,  0,    0,    255,  255,  0,    ],
            [255,  255,  0,    1,    255,  0,    1,    ],
            [255,  255,  0,    128,  255,  127,  1,    ],
            [255,  255,  0,    254,  255,  253,  1,    ],
            [255,  255,  0,    255,  255,  254,  1,    ],
            [255,  255,  1,    0,    0,    0,    1,    ],
            [255,  255,  1,    1,    0,    1,    1,    ],
            [255,  255,  1,    128,  0,    128,  1,    ],
            [255,  255,  1,    254,  0,    254,  1,    ],
            [255,  255,  1,    255,  0,    255,  1,    ],
            [255,  255,  128,  0,    127,  0,    1,    ],
            [255,  255,  128,  1,    127,  1,    1,    ],
            [255,  255,  128,  128,  127,  128,  1,    ],
            [255,  255,  128,  254,  127,  254,  1,    ],
            [255,  255,  128,  255,  127,  255,  1,    ],
            [255,  255,  254,  0,    253,  0,    1,    ],
            [255,  255,  254,  1,    253,  1,    1,    ],
            [255,  255,  254,  128,  253,  128,  1,    ],
            [255,  255,  254,  254,  253,  254,  1,    ],
            [255,  255,  254,  255,  253,  255,  1,    ],
            [255,  255,  255,  0,    254,  0,    1,    ],
            [255,  255,  255,  1,    254,  1,    1,    ],
            [255,  255,  255,  128,  254,  128,  1,    ],
            [255,  255,  255,  254,  254,  254,  1,    ],
            [255,  255,  255,  255,  254,  255,  1,    ],
        ]

        for row in table {
            let s = sum([row[0], row[1]], [row[2], row[3]])
            XCTAssertEqual(s.result, [row[4], row[5]], "( \(row[0]), \(row[1]) ) + ( \(row[2]), \(row[3]) )")
            XCTAssertEqual(s.overflow, row[6], "( \(row[0]), \(row[1]) ) + ( \(row[2]), \(row[3]) )")
        }
    }

    func util_generateTable_sum() {
        let S: [UInt8] = [0, 1, 128, 254, 255]
        var table: [[Digit]] = []
        for a0 in S {
            for a1 in S {
                for b0 in S {
                    for b1 in S {
                        // result = UInt16 &+ UInt16
                        let a: UInt16 = UInt16(a0) + UInt16(a1) * 1 << 8
                        let b: UInt16 = UInt16(b0) + UInt16(b1) * 1 << 8
                        let c = a &+ b
                        let c1 = c / 1 << 8
                        let c0 = c - c1 * 1 << 8
                        let overflow: Digit = c < a || c < b ? 1 : 0
                        let row = [a0, a1, b0, b1, Digit(c0), Digit(c1), overflow]
                        table.append(row)
                    }
                }
            }
        }
        util_print_table(table)

    }

    // MARK: subtraction

    func test_subtract_1digit_overflow_1() {
        let (d, c) = subtractScalars(Digit(0), Digit(1))
        XCTAssertEqual(d, 255, "invalid difference")
        XCTAssertEqual(c, 1, "expected overflow")
    }

    func test_subtract_1digit_overflow_2() {
        let (d, c) = subtractScalars(Digit(0), Digit(2))
        XCTAssertEqual(d, 254, "invalid difference")
        XCTAssertEqual(c, 1, "expected overflow")
    }

    func test_subtract_1digit_no_overflow() {
        let (d, c) = subtractScalars(Digit(255), Digit(1))
        XCTAssertEqual(d, 254, "invalid difference")
        XCTAssertEqual(c, 0, "expected overflow")
    }

    func test_subtract_2digit_overflow() {
        let a: [Digit] = [3, 2] // 515
        let b: [Digit] = [255, 255] // 65.535
        let c: [Digit] = [4, 2] // 514

        let (s, o) = subtract(a, b)

        XCTAssertEqual(s, c, "invlaid sum")
        XCTAssertEqual(o, 1, "expected to overflow")
    }

    func test_multiplyScalars() {
        let table: [[Digit]] = [
        //  [a,     b,     c[0],   c[1]
            [0,     0,      0,      0],
            [0,     1,      0,      0],
            [0,     128,    0,      0],
            [0,     254,    0,      0],
            [0,     255,    0,      0],

            [1,     0,      0,      0],
            [1,     1,      1,      0],
            [1,     128,  128,      0],
            [1,     254,  254,      0],
            [1,     255,  255,      0],

            [128,   0,      0,      0],
            [128,   1,     128,     0],
            [128,   128,    0,     64],
            [128,   254,    0,    127],
            [128,   255,  128,    127],

            [254,   0,      0,      0],
            [254,   1,    254,      0],
            [254,   128,    0,    127],
            [254,   254,    4,    252],
            [254,   255,    2,    253],

            [255,   0,      0,      0],
            [255,   1,    255,      0],
            [255,   128,  128,    127],
            [255,   254,    2,    253],
            [255,   255,    1,    254],
        ]

        for row in table {
            let product = multiplyScalars(row[0], row[1])
            let expected = [row[2], row[3]]
            XCTAssertEqual(product, expected, "\(row[0]) x \(row[1])")
        }
    }

    func test_multiplyByScalar() {
        // To re-generate the table, uncomment and take the console output from:
        // util_generate_multiplyByScalarTable()

        let table: [[Digit]] = [
        //  [a,   b0,   b1,   c0,   c1,   c2     ],
            [0,    0,    0,    0,    0,    0,    ],
            [0,    0,    1,    0,    0,    0,    ],
            [0,    0,    128,  0,    0,    0,    ],
            [0,    0,    254,  0,    0,    0,    ],
            [0,    0,    255,  0,    0,    0,    ],
            [0,    1,    0,    0,    0,    0,    ],
            [0,    1,    1,    0,    0,    0,    ],
            [0,    1,    128,  0,    0,    0,    ],
            [0,    1,    254,  0,    0,    0,    ],
            [0,    1,    255,  0,    0,    0,    ],
            [0,    128,  0,    0,    0,    0,    ],
            [0,    128,  1,    0,    0,    0,    ],
            [0,    128,  128,  0,    0,    0,    ],
            [0,    128,  254,  0,    0,    0,    ],
            [0,    128,  255,  0,    0,    0,    ],
            [0,    254,  0,    0,    0,    0,    ],
            [0,    254,  1,    0,    0,    0,    ],
            [0,    254,  128,  0,    0,    0,    ],
            [0,    254,  254,  0,    0,    0,    ],
            [0,    254,  255,  0,    0,    0,    ],
            [0,    255,  0,    0,    0,    0,    ],
            [0,    255,  1,    0,    0,    0,    ],
            [0,    255,  128,  0,    0,    0,    ],
            [0,    255,  254,  0,    0,    0,    ],
            [0,    255,  255,  0,    0,    0,    ],
            [1,    0,    0,    0,    0,    0,    ],
            [1,    0,    1,    0,    1,    0,    ],
            [1,    0,    128,  0,    128,  0,    ],
            [1,    0,    254,  0,    254,  0,    ],
            [1,    0,    255,  0,    255,  0,    ],
            [1,    1,    0,    1,    0,    0,    ],
            [1,    1,    1,    1,    1,    0,    ],
            [1,    1,    128,  1,    128,  0,    ],
            [1,    1,    254,  1,    254,  0,    ],
            [1,    1,    255,  1,    255,  0,    ],
            [1,    128,  0,    128,  0,    0,    ],
            [1,    128,  1,    128,  1,    0,    ],
            [1,    128,  128,  128,  128,  0,    ],
            [1,    128,  254,  128,  254,  0,    ],
            [1,    128,  255,  128,  255,  0,    ],
            [1,    254,  0,    254,  0,    0,    ],
            [1,    254,  1,    254,  1,    0,    ],
            [1,    254,  128,  254,  128,  0,    ],
            [1,    254,  254,  254,  254,  0,    ],
            [1,    254,  255,  254,  255,  0,    ],
            [1,    255,  0,    255,  0,    0,    ],
            [1,    255,  1,    255,  1,    0,    ],
            [1,    255,  128,  255,  128,  0,    ],
            [1,    255,  254,  255,  254,  0,    ],
            [1,    255,  255,  255,  255,  0,    ],
            [128,  0,    0,    0,    0,    0,    ],
            [128,  0,    1,    0,    128,  0,    ],
            [128,  0,    128,  0,    0,    64,   ],
            [128,  0,    254,  0,    0,    127,  ],
            [128,  0,    255,  0,    128,  127,  ],
            [128,  1,    0,    128,  0,    0,    ],
            [128,  1,    1,    128,  128,  0,    ],
            [128,  1,    128,  128,  0,    64,   ],
            [128,  1,    254,  128,  0,    127,  ],
            [128,  1,    255,  128,  128,  127,  ],
            [128,  128,  0,    0,    64,   0,    ],
            [128,  128,  1,    0,    192,  0,    ],
            [128,  128,  128,  0,    64,   64,   ],
            [128,  128,  254,  0,    64,   127,  ],
            [128,  128,  255,  0,    192,  127,  ],
            [128,  254,  0,    0,    127,  0,    ],
            [128,  254,  1,    0,    255,  0,    ],
            [128,  254,  128,  0,    127,  64,   ],
            [128,  254,  254,  0,    127,  127,  ],
            [128,  254,  255,  0,    255,  127,  ],
            [128,  255,  0,    128,  127,  0,    ],
            [128,  255,  1,    128,  255,  0,    ],
            [128,  255,  128,  128,  127,  64,   ],
            [128,  255,  254,  128,  127,  127,  ],
            [128,  255,  255,  128,  255,  127,  ],
            [254,  0,    0,    0,    0,    0,    ],
            [254,  0,    1,    0,    254,  0,    ],
            [254,  0,    128,  0,    0,    127,  ],
            [254,  0,    254,  0,    4,    252,  ],
            [254,  0,    255,  0,    2,    253,  ],
            [254,  1,    0,    254,  0,    0,    ],
            [254,  1,    1,    254,  254,  0,    ],
            [254,  1,    128,  254,  0,    127,  ],
            [254,  1,    254,  254,  4,    252,  ],
            [254,  1,    255,  254,  2,    253,  ],
            [254,  128,  0,    0,    127,  0,    ],
            [254,  128,  1,    0,    125,  1,    ],
            [254,  128,  128,  0,    127,  127,  ],
            [254,  128,  254,  0,    131,  252,  ],
            [254,  128,  255,  0,    129,  253,  ],
            [254,  254,  0,    4,    252,  0,    ],
            [254,  254,  1,    4,    250,  1,    ],
            [254,  254,  128,  4,    252,  127,  ],
            [254,  254,  254,  4,    0,    253,  ],
            [254,  254,  255,  4,    254,  253,  ],
            [254,  255,  0,    2,    253,  0,    ],
            [254,  255,  1,    2,    251,  1,    ],
            [254,  255,  128,  2,    253,  127,  ],
            [254,  255,  254,  2,    1,    253,  ],
            [254,  255,  255,  2,    255,  253,  ],
            [255,  0,    0,    0,    0,    0,    ],
            [255,  0,    1,    0,    255,  0,    ],
            [255,  0,    128,  0,    128,  127,  ],
            [255,  0,    254,  0,    2,    253,  ],
            [255,  0,    255,  0,    1,    254,  ],
            [255,  1,    0,    255,  0,    0,    ],
            [255,  1,    1,    255,  255,  0,    ],
            [255,  1,    128,  255,  128,  127,  ],
            [255,  1,    254,  255,  2,    253,  ],
            [255,  1,    255,  255,  1,    254,  ],
            [255,  128,  0,    128,  127,  0,    ],
            [255,  128,  1,    128,  126,  1,    ],
            [255,  128,  128,  128,  255,  127,  ],
            [255,  128,  254,  128,  129,  253,  ],
            [255,  128,  255,  128,  128,  254,  ],
            [255,  254,  0,    2,    253,  0,    ],
            [255,  254,  1,    2,    252,  1,    ],
            [255,  254,  128,  2,    125,  128,  ],
            [255,  254,  254,  2,    255,  253,  ],
            [255,  254,  255,  2,    254,  254,  ],
            [255,  255,  0,    1,    254,  0,    ],
            [255,  255,  1,    1,    253,  1,    ],
            [255,  255,  128,  1,    126,  128,  ],
            [255,  255,  254,  1,    0,    254,  ],
            [255,  255,  255,  1,    255,  254,  ],
        ]

        for row in table {
            let product = multiplyByScalar(row[0], [row[1], row[2]])
            let expected = [row[3], row[4], row[5]]
            XCTAssertEqual(product, expected, "\(row[0]) x (\(row[1]), \(row[2]))")
        }
    }

    /// Generates a table for testing `multiplyByScalar`
    ///
    /// Generates a table for testing scalar with vector multiplication:
    ///
    ///     a x b = c
    ///
    /// where `a` is a Digit, `b` is a 2-digit number, and `c` is a 3-digit number in base-256 (2^8)
    func util_generate_multiplyByScalarTable() {
        let S: [UInt8] = [0, 1, 128, 254, 255]
        var table: [[Digit]] = []
        for a in S {
            for b0 in S {
                for b1 in S {
                    // for reference:
                    // 2 ^ 8 = 1 << 8 = 256
                    // 2 ^ 16 = 1 << 16 = 65.536

                    let c: UInt32 = UInt32(a) * (UInt32(b0) + UInt32(b1) * 1 << 8)
                    let c2 = c / 1 << 16
                    let c1 = (c - c2 * 1 << 16) / (1 << 8)
                    let c0 = (c - (c2 * 1 << 16 + c1 * 1 << 8))

                    assert(c0 + 1 << 8 * c1 + 1 << 16 * c2 == c)

                    let row = [a, b0, b1, UInt8(c0), UInt8(c1), UInt8(c2)]

                    table.append(row)
                }
            }
        }

        util_print_table(table)
    }

    func util_print_table(_ table: [[Digit]]) {
        print("[")
        for row in table {
            print("[" +
                  row.map { "\($0),".padding(toLength: 6, withPad: " ", startingAt: 0)}.joined() +
                  "],")
        }
        print("]")
    }
}
